<ng-template #titleTemplateRef let-feature>
  {{ feature?.id }} - {{ feature?.wkoName }}
</ng-template>

<ng-template #subtitleTemplateRef let-feature>
  <div class="task-sub">
    <span *ngIf="actions">{{ getAction(feature?.wtrId) }}</span>
    <!-- <span>
      <ng-container *ngIf="feature?.wkoCompletionStartDate !== feature?.wkoCompletionEndDate; else monoDate">
        {{ feature?.wkoPlanningStartDate | date: 'dd/MM/yyyy' }} - {{ feature?.wkoPlanningEndDate | date: 'dd/MM/yyyy' }}
      </ng-container>
      <ng-template #monoDate>
        {{ feature?.wkoCompletionEndDate | date: 'dd/MM/yyyy' }}
      </ng-template>
    </span> -->
  </div>
</ng-template>

<ng-template #labelTemplateRef let-feature>
  {{ feature?.wkoAddress }}
</ng-template>

<ng-template #chipTemplateRef let-feature>
  <ion-chip class="status" *ngIf="feature?.wtsId && status" [ngClass]="'status-' + getStatusCode(feature.wtsId)" [outline]="false">
    <ion-icon [name]="'close-outline'"></ion-icon>
    <ion-label>{{ getStatusLabel(feature.wtsId) }}</ion-label>
  </ion-chip>
  <ion-chip *ngIf="feature?.wkoEmergency" [outline]="true" class="status">
    <ion-icon name="calendar-outline"></ion-icon>
    <ion-label>Urgent</ion-label>
  </ion-chip>
  <ion-chip *ngIf="feature?.wkoAppointment" [outline]="false" class="status">
    <ion-icon name="calendar-outline"></ion-icon>
    <ion-label>Rendez-vous</ion-label>
  </ion-chip>
  <ion-label *ngIf="getStatusCode(feature.wtsId) === 'TERMINE'" slot="end">
    <ion-note>
      <ng-container *ngIf="!sameCompletionDate(feature) && feature?.wkoCompletionStartDate; else monoDate">
        {{ feature?.wkoCompletionStartDate | date: 'dd/MM/yyyy' }} - {{ feature?.wkoCompletionEndDate | date: 'dd/MM/yyyy' }}
      </ng-container>
      <ng-template #monoDate>
        {{ feature?.wkoCompletionEndDate | date: 'dd/MM/yyyy' }}
      </ng-template>
    </ion-note>
  </ion-label>
</ng-template>

<app-exp-card [features]="tasks" [type]="'workorder'" [titleTemplateRef]="titleTemplateRef" [isLoading]="loading"
  [subtitleTemplateRef]="subtitleTemplateRef" [labelTemplateRef]="labelTemplateRef" [chipTemplateRef]="chipTemplateRef"
  [fromCache]="isMapTasks" (onLoadingEvent)="getPaginationData($event)" (onFeatureSelected)="openTask($event)">
</app-exp-card>
