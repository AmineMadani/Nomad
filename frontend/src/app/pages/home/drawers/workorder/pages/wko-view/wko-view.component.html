<app-page-header [headerLabel]="'I-' + workOrder?.id" [loading]="loading"></app-page-header>

<ion-tab-bar class="action-bar" slot="top">
  <ion-tab-button [disabled]="loading" (click)="onGenerateReport()">
    <ion-icon name="reader-outline"></ion-icon>
    Compte-rendu
  </ion-tab-button>
  <ion-tab-button [disabled]="loading">
    <ion-icon name="link-outline"></ion-icon>
    Ajouter à un programme
  </ion-tab-button>
  <ion-tab-button [disabled]="loading">
    <ion-icon name="pencil-outline"></ion-icon>
    Mettre à jour
  </ion-tab-button>
  <ion-tab-button [disabled]="loading" (click)="cancelWorkorder()">
    <ion-icon name="trash-bin-outline"></ion-icon>
    Annuler
  </ion-tab-button>
</ion-tab-bar>

<ng-container *ngIf="!loading; else loadingBody">
  <ion-item lines="none" class="ion-text-center">
    <ion-label class="rdv-label">
      {{ workOrder.wkoName }}
    </ion-label>
  </ion-item>
  <ion-item lines="none" class="ion-text-center">
    <ion-label>
      <ion-chip *ngIf="workOrder.wtsId" [ngClass]="'status-PLANIFIE'" [outline]="false">
        <ion-label>{{ status }}</ion-label>
      </ion-chip>
      <ion-chip *ngIf="workOrder.wkoEmergency" class="status" [outline]="true">
        <ion-icon name="calendar-outline"></ion-icon>
        <ion-label>Urgent</ion-label>
      </ion-chip>
      <ion-chip *ngIf="workOrder.wkoAppointment" class="status" [outline]="false">
        <ion-icon name="calendar-outline"></ion-icon>
        <ion-label>Rendez-vous</ion-label>
      </ion-chip>
      <ion-chip color="secondary" *ngIf="taskId && workOrder.tasks.length > 1" (click)="onDisplayWorkorder()"
        [outline]="false">
        <ion-icon style="margin-left: -4px" name="albums-outline"></ion-icon>
      </ion-chip>
    </ion-label>
  </ion-item>

  <ion-accordion-group [multiple]="true" [value]="((taskId || workOrder.tasks.length == 1) && selectedTask?.report.dateCompletion && selectedTask?.report.reportValues) ? ['General','report'] : ['General','intervention']">
    <ion-accordion value="General" [readonly]="true">
      <ion-item slot="header" color="light">
        <ion-label> Généralités </ion-label>
      </ion-item>
      <div slot="content">
        <ion-item lines="none">
          <ion-label class="label">
            <h3>Patrimoine</h3>
            <p>{{ (taskId || workOrder.tasks.length == 1) ? (assetLabel?.length > 0 ? assetLabel +' - ' +
              selectedTask.assObjRef : 'Non défini') : 'Multi-equipement' }}</p>
          </ion-label>
        </ion-item>
        <ion-item lines="none">
          <ion-label class="label">
            <h3>Raison</h3>
            <p>{{ reason }}</p>
          </ion-label>
        </ion-item>
        <ion-item lines="none">
          <ion-label class="label">
            <h3>Address</h3>
            <p>{{ workOrder.wkoAddress }}</p>
          </ion-label>
        </ion-item>
      </div>
    </ion-accordion>
    <ion-accordion value="report"
      *ngIf="(taskId || workOrder.tasks.length == 1) && selectedTask?.report.dateCompletion && selectedTask?.report.reportValues">
      <ion-item slot="header" color="light">
        <ion-label> Compte-rendu </ion-label>
      </ion-item>
      <div slot="content">
        <ion-item lines="none">
          <ion-label class="label">
            <h3>Date de réalisation</h3>
            <p>{{ selectedTask.report.dateCompletion | date: 'dd/MM/yyyy'}}</p>
          </ion-label>
        </ion-item>
        <ion-item lines="none" *ngFor="let report of selectedTask.report.reportValues">
          <ion-label class="label">
            <h3 class="break-line"> <span>{{ report.question }}</span></h3>
            <p>{{ report.answer }}</p>
          </ion-label>
        </ion-item>

      </div>
    </ion-accordion>
    <ion-accordion value="intervention">
      <ion-item slot="header" color="light">
        <ion-label> Interventions </ion-label>
      </ion-item>
      <div slot="content">
        <ion-item lines="none">
          <ion-label class="label">
            <h3>Date de début</h3>
            <p>{{ workOrder.wkoPlanningStartDate | date: 'dd/MM/yyyy' }}</p>
          </ion-label>
        </ion-item>

        <ion-item lines="none">
          <ion-label class="label">
            <h3>Date de fin</h3>
            <p>{{ workOrder.wkoPlanningEndDate | date: 'dd/MM/yyyy' }}</p>
          </ion-label>
        </ion-item>
        <ion-item lines="none">
          <ion-label class="label">
            <h3>Nombre d'agents</h3>
            <p>{{ workOrder.wkoAgentNb }}</p>
          </ion-label>
        </ion-item>
        <ion-item lines="none">
          <ion-label class="label">
            <h3>Commentaire</h3>
            <p>{{ workOrder.wkoCreationComment }}</p>
          </ion-label>
        </ion-item>
      </div>
    </ion-accordion>
  </ion-accordion-group>

</ng-container>

<ng-template #loadingBody>
  <ion-item lines="none" class="skeleton-label">
    <ion-skeleton-text [animated]="true" style="width: 30%;"></ion-skeleton-text>
  </ion-item>
  <ion-item lines="none" class="skeleton-status">
    <ion-skeleton-text [animated]="true" style="width: 20%;"></ion-skeleton-text>
  </ion-item>
  <ion-list>
    <ion-item lines="none" class="ion-no-margin" *ngFor="let number of [0,1,2,3,4,5,6,7]">
      <ion-label class="label">
        <h3>
          <ion-skeleton-text [animated]="true" style="width: 30%;"></ion-skeleton-text>
        </h3>
        <p>
          <ion-skeleton-text [animated]="true" style="width: 60%;"></ion-skeleton-text>
        </p>
      </ion-label>
    </ion-item>
  </ion-list>
</ng-template>