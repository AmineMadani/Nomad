<ion-item lines="none" *ngIf="!isTest">
  <ion-button *ngIf="!isMobile" fill="clear" slot="start" (click)="onDrawerBack()">
    <ion-icon size="small" slot="icon-only" name="arrow-back"></ion-icon>
  </ion-button>
  <ion-label class="header-label">Compte-rendu</ion-label>
  <ion-icon *ngIf="workorder.id < 0" size="small" slot="end" name="trash-outline" (click)="onDelete()"></ion-icon>

  <ion-icon size="small" slot="end" name="close-outline" (click)="onClose()"></ion-icon>
</ion-item>

<div class="filter-content">
  <app-report-stepper [step]="step" *ngIf="!isTest"></app-report-stepper>

  <!-- We place the footer below the stepper in mobile mode -->
  <app-report-footer-actions *ngIf="isMobile" [isMobile]="isMobile" [isSubmitting]="isSubmitting" [step]="step"
    [workorder]="workorder" [hasPreviousQuestion]="hasPreviousQuestion" [isTest]="isTest" [hasXYInvalid]="hasXYInvalid"
    [isSubmit]="isSubmit" [selectedTasks]="selectedTasks" [hasReportClosed]="hasReportClosed()"
    (onEditTask)="onEditTask()" (onNewAsset)="onNewAsset()" (onBack)="onBack()" (onNext)="onNext()"
    (onPreviousFormQuestion)="previousFormQuestion()" (onNextFormQuestion)="nextFormQuestion()"
    (onConfirmDate)="onConfirmDate()" (onFormSubmit)="submitForm($event)" (onGoToFirstStep)="onGoToFirstStep()">
  </app-report-footer-actions>

  <ng-container *ngIf="step === 1">
    <app-report-asset [workorder]="workorder" [selectedTasks]="selectedTasks" (onSelectedTaskChange)="onSelectedTaskChange($event)" (onSaveWorkOrderState)="onSaveWorkOrderState()" #stepAsset></app-report-asset>
  </ng-container>
  <ng-container *ngIf="step === 2">
    <app-report-context [workorder]="workorder" [tasks]="selectedTasks" (onSaveWorkOrderState)="onSaveWorkOrderState()"></app-report-context>
  </ng-container>
  <ng-container *ngIf="step === 3">
    <app-report-form [tasks]="selectedTasks" (onSaveWorkOrderState)="onSaveWorkOrderState()"
      (goToNextQuestion)="nextFormQuestion()" [workorder]="workorder"
      [reportForm]="reportForm" [isTest]="isTest" #stepForm></app-report-form>
  </ng-container>
  <ng-container *ngIf="step === 4">
    <app-report-date #reportDate></app-report-date>
  </ng-container>
  <div *ngIf="step === 3" class="form-questions-count">
    <ion-progress-bar [value]="getReportProgress()"></ion-progress-bar>
  </div>
</div>

<!-- We place the footer below all the drawer in web mode -->
<app-report-footer-actions *ngIf="!isMobile" [isMobile]="isMobile" [isSubmitting]="isSubmitting" [step]="step"
  [workorder]="workorder" [hasPreviousQuestion]="hasPreviousQuestion" [isTest]="isTest"
  [hasXYInvalid]="hasXYInvalid" [isSubmit]="isSubmit" [selectedTasks]="selectedTasks" [hasReportClosed]="hasReportClosed()"
  (onEditTask)="onEditTask()" (onNewAsset)="onNewAsset()"
  (onBack)="onBack()" (onNext)="onNext()" (onPreviousFormQuestion)="previousFormQuestion()"
  (onNextFormQuestion)="nextFormQuestion()" (onConfirmDate)="onConfirmDate()"
  (onFormSubmit)="submitForm($event)" (onGoToFirstStep)="onGoToFirstStep()">
</app-report-footer-actions>
