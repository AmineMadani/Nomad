<ion-item lines="none">
  <ion-button *ngIf="!isMobile" fill="clear" slot="start" (click)="onDrawerBack()">
    <ion-icon size="small" slot="icon-only" name="arrow-back"></ion-icon>
  </ion-button>
  <ion-label class="header-label">Compte-rendu</ion-label>
  <ion-icon size="small" slot="end" name="close-outline" (click)="onClose()"></ion-icon>
</ion-item>

<div class="filter-content">
  <app-report-stepper [step]="step"></app-report-stepper>
  <ng-container *ngIf="step == 1">
    <app-report-asset [workorder]="workorder" [selectedTask]="selectedTask" (onSelectedTaskChange)="onSelectedTaskChange($event)" (onSaveWorkOrderState)="onSaveWorkOrderState()"></app-report-asset>
  </ng-container>
  <ng-container *ngIf="step == 2">
    <app-report-context [task]="selectedTask" (onSaveWorkOrderState)="onSaveWorkOrderState()"></app-report-context>
  </ng-container>
  <ng-container *ngIf="step == 3">
    <app-report-form [task]="selectedTask" (onSaveWorkOrderState)="onSaveWorkOrderState()" #stepForm></app-report-form>
  </ng-container>
  <div *ngIf="step == 3" class="form-questions-count">
    {{getFormQuestionLabel()}}
  </div>
</div>
<div class="report-footer-actions" lines="none">
  <ng-container *ngIf="!isSubmitting">
    <ion-button *ngIf="step >= 2 && !hasPreviousQuestion" fill="clear" style="float: left;" (click)="onBack()" [class.font-mobile]="isMobile">Etape précédente</ion-button>
    <ion-button *ngIf="(step == 1 && selectedTask) || (step == 2 && selectedTask.wtrId)" fill="clear" style="margin-left: auto;" (click)="onNext()" [class.font-mobile]="isMobile">Etape suivante</ion-button>
    <ion-button *ngIf="(step == 3) && hasPreviousQuestion" fill="clear" (click)="previousFormQuestion()" [class.font-mobile]="isMobile">Question précédente</ion-button>
    <ion-button *ngIf="step == 3 && !isSubmit" fill="clear" (click)="nextFormQuestion()" [class.font-mobile]="isMobile">Question suivante</ion-button>
    <ion-button *ngIf="isSubmit" fill="clear" (click)="submitForm()" [class.font-mobile]="isMobile">Clôturer</ion-button>
  </ng-container>
  <ng-container *ngIf="isSubmitting">
    <ion-item lines="none" style="margin: auto;">
      <ion-spinner name="circular" color="primary" style="margin-right: 10px;"></ion-spinner>
      <ion-label>Clôture en cours...</ion-label>
    </ion-item>
  </ng-container>
</div>